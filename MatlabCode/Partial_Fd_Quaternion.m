function [PartialFd] = Partial_Fd_Quaternion(t, Xaug, Target, Chasser)

% 
global mu_Earth X_chief tspan JD AU
idx = find(tspan <= t, 1, 'last' );
%% Collecting relevant quantities
q_Chasser = Xaug(1:4,1)/norm(Xaug(1:4,:));
Omega_Chasser_body = Xaug(5:7,:);
rho_aug  = Xaug(8:13,:);
r_target = X_chief(idx,1:3)'; v_target = X_chief(idx,4:6)';

%% Computing quantities used in the routine
rt_norm = norm(r_target);
rho = rho_aug(1:3,:);
r_c = [rt_norm+rho(1) rho(2) rho(3)]'; % RIC position of the chasser
CN = DCM(r_target,v_target); % DCM's between target's RIC frame and ECI frame
BN = Quaternion_to_DCM(q_Chasser);
rDeputy = CN\r_c; % ECI position of the chasser

%% Computing the angular velocity and angular acceleration of the target frame
[u_acc,Xrel, V_sun, beta_chief] = F_CanonBall(t,r_target,Target); % SRP force on the Target
h_vec = cross(r_target,v_target); h_norm = norm(h_vec);
eh = h_vec/h_norm; h_dot = cross(r_target,u_acc); r_rel_norm = norm(Xrel);
eh_dot = h_dot/h_norm - dot(h_vec,h_dot)*h_vec/h_norm^3;
V_rel = V_sun - v_target;
u_acc_dot = beta_chief*(V_rel/r_rel_norm^3 - 3*dot(Xrel,V_rel)*Xrel/r_rel_norm^5);

    
OmegaCh = CN*( h_vec/rt_norm^2 + dot(u_acc,eh)*r_target/h_norm );  
OmegadotCh = CN*( h_dot/rt_norm^2 ...
                -2*dot(r_target,v_target)*h_vec/rt_norm^4 ...
                - dot(h_vec,h_dot)*dot(u_acc,eh)*r_target/h_norm^3 ...
                + (dot(u_acc_dot,eh) + dot(u_acc,eh_dot))*r_target/h_norm ...
                + dot(u_acc,eh)*v_target/h_norm );
            
%% Computing the parameters for SRP acceleration 
Pcrp = 1357/(299792458); % Solar pressure
JulianDay = JD+tspan(idx)/86400;
[XS, ~, ~] = Ephem(JulianDay,3,'EME2000');
s = (XS-rDeputy)/norm((XS-rDeputy)); s = BN*s;
rhos = Chasser.rhos;rhod = Chasser.rhod;
area = Chasser.L*Chasser.l;
Cr   = Chasser.Cr;
mass = Chasser.M+Chasser.m;
rs_squared = norm((XS-rDeputy)/AU)^2;
n = [0 0 1]'; Costheta = dot(n,s);
if Costheta<0
    PD = 0;
else
    PD = -Cr*Pcrp*area/(1000*mass*rs_squared);
end

%% Initializing the terms used in the routine
Rc1 = r_target(1,:); Rc2 = r_target(2,:); Rc3 = r_target(3,:);
Vc1 = v_target(1,:); Vc2 = v_target(2,:); Vc3 = v_target(3,:);
q0 = q_Chasser(1,:); q1 = q_Chasser(2,:); q2 = q_Chasser(3,:); q3 = q_Chasser(4,:);
rSun = -XS;
Rsun1 = -XS(1); Rsun2 = -XS(2); Rsun3 = -XS(3);
CBmatrix = CN*BN';
rSunDeputy = XS - rDeputy;
n3Vec = BN(3,:)';
const1 = (1-rhos); const2 = 2*rhos; const3 = rhod;
rho1 = rho(1); rho2 = rho(2); rho3 = rho(3);
omegaCh1 = OmegaCh(1); omegaCh2 = OmegaCh(2); omegaCh3 = OmegaCh(3);
omegaChdot1 = OmegadotCh(1); omegaChdot2 = OmegadotCh(2); omegaChdot3 = OmegadotCh(3);
omg1 = Omega_Chasser_body(1,:); omg2 = Omega_Chasser_body(2,:); omg3 = Omega_Chasser_body(3,:); 
Acc = F_SPR_FlatPlate(t,rDeputy,Chasser,q_Chasser);
Acc = Acc(4:6);
I = diag(Chasser.Moment_Of_Inertia_Calculator());
i1 = I(1,1); i2 = I(2,2); i3 = I(3,3);


% %%
% clc
% Rc1 = 10; Rc2 = 21; Rc3 = 31;
% Vc1 = -3; Vc2 = -1.5; Vc3 = 1.1;
% q0 = .4; q1 = .2; q2 = .1; q3 = .5;
% rSun = 10*[.2 4 7]';
% Rsun1 = rSun(1); Rsun2 = rSun(2); Rsun3 = rSun(3);
% CBmatrix = eye(3);
% rDeputy = 5*[10 2 4]';
% rSunDeputy = 2*[9 4 1]';
% n3Vec = [0 0 1]';
% const1 = 0.1; const2 = 0.3; const3 = 0.6;
% rho1 = 1.1; rho2 = 2.1; rho3 = 2.3;
% omegaCh1 = 1; omegaCh2 = .3; omegaCh3 = .5;
% omegaChdot1 = 1.1; omegaChdot2 = 1.6; omegaChdot3 = 2.3;
% omg1 = 2.1; omg2 = 1.2; omg3 = 3.5; 
% muEarth = 1000;
% PD = 100;
% Acc = [0.00224944 8.30211*10^-6 0.00447954]';
% i1 = 1; i2 = 2; i3 = 3;


%% % Partial of the SRP froce on the deputy plate (as seen in chief LVLH frame)
% ------------------------------------------------------------------------
pCb1pQvec=[2.*(q0.*Rc1+q3.*Rc2+(-1).*q2.*Rc3).*(Rc1.^2+Rc2.^2+Rc3.^2).^( ...
  -1/2),2.*(q1.*Rc1+q2.*Rc2+q3.*Rc3).*(Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2) ...
  ,(-2).*(q2.*Rc1+(-1).*q1.*Rc2+q0.*Rc3).*(Rc1.^2+Rc2.^2+Rc3.^2).^( ...
  -1/2),2.*((-1).*q3.*Rc1+q0.*Rc2+q1.*Rc3).*(Rc1.^2+Rc2.^2+Rc3.^2) ...
  .^(-1/2);2.*((-1).*q3.*Rc1+q0.*Rc2+q1.*Rc3).*(Rc1.^2+Rc2.^2+ ...
  Rc3.^2).^(-1/2),2.*(q2.*Rc1+(-1).*q1.*Rc2+q0.*Rc3).*(Rc1.^2+ ...
  Rc2.^2+Rc3.^2).^(-1/2),2.*(q1.*Rc1+q2.*Rc2+q3.*Rc3).*(Rc1.^2+ ...
  Rc2.^2+Rc3.^2).^(-1/2),(-2).*(q0.*Rc1+q3.*Rc2+(-1).*q2.*Rc3).*( ...
  Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2);2.*(q2.*Rc1+(-1).*q1.*Rc2+q0.*Rc3).* ...
  (Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2),(-2).*((-1).*q3.*Rc1+q0.*Rc2+q1.* ...
  Rc3).*(Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2),2.*(q0.*Rc1+q3.*Rc2+(-1).* ...
  q2.*Rc3).*(Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2),2.*(q1.*Rc1+q2.*Rc2+q3.* ...
  Rc3).*(Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2)];


pCb1pXstate = [pCb1pQvec, zeros(3,9)];

% ------------------------------------------------------------------------
pCb2pQvec=[2.*(Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2).*((-1).*q3.*Rc1.*Rc2.*Vc1+q0.* ...
  Rc2.^2.*Vc1+q2.*Rc1.*Rc3.*Vc1+q0.*Rc3.^2.*Vc1+q3.*Rc1.^2.*Vc2+(-1) ...
  .*q0.*Rc1.*Rc2.*Vc2+q2.*Rc2.*Rc3.*Vc2+q3.*Rc3.^2.*Vc2+(-1).*(q2.*( ...
  Rc1.^2+Rc2.^2)+(q0.*Rc1+q3.*Rc2).*Rc3).*Vc3).*((Rc2.*Vc1+(-1).* ...
  Rc1.*Vc2).^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.* ...
  Vc3).^2).^(-1/2),2.*(Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2).*((Rc2.*Vc1+( ...
  -1).*Rc1.*Vc2).^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).* ...
  Rc2.*Vc3).^2).^(-1/2).*((-1).*q3.*Rc3.*(Rc1.*Vc1+Rc2.*Vc2)+q3.*( ...
  Rc1.^2+Rc2.^2).*Vc3+q1.*(Rc2.^2.*Vc1+Rc3.^2.*Vc1+(-1).*Rc1.*Rc2.* ...
  Vc2+(-1).*Rc1.*Rc3.*Vc3)+q2.*((-1).*Rc1.*Rc2.*Vc1+Rc1.^2.*Vc2+ ...
  Rc3.*(Rc3.*Vc2+(-1).*Rc2.*Vc3))),2.*(Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2) ...
  .*((Rc2.*Vc1+(-1).*Rc1.*Vc2).^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+( ...
  Rc3.*Vc2+(-1).*Rc2.*Vc3).^2).^(-1/2).*(q0.*Rc3.*(Rc1.*Vc1+Rc2.* ...
  Vc2)+(-1).*q0.*(Rc1.^2+Rc2.^2).*Vc3+q2.*((-1).*Rc2.^2.*Vc1+(-1).* ...
  Rc3.^2.*Vc1+Rc1.*Rc2.*Vc2+Rc1.*Rc3.*Vc3)+q1.*((-1).*Rc1.*Rc2.*Vc1+ ...
  Rc1.^2.*Vc2+Rc3.*(Rc3.*Vc2+(-1).*Rc2.*Vc3))),2.*(Rc1.^2+Rc2.^2+ ...
  Rc3.^2).^(-1/2).*((Rc2.*Vc1+(-1).*Rc1.*Vc2).^2+(Rc3.*Vc1+(-1).* ...
  Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.*Vc3).^2).^(-1/2).*((-1).*q1.* ...
  Rc3.*(Rc1.*Vc1+Rc2.*Vc2)+q1.*(Rc1.^2+Rc2.^2).*Vc3+q3.*((-1).* ...
  Rc2.^2.*Vc1+(-1).*Rc3.^2.*Vc1+Rc1.*Rc2.*Vc2+Rc1.*Rc3.*Vc3)+q0.*(( ...
  -1).*Rc1.*Rc2.*Vc1+Rc1.^2.*Vc2+Rc3.*(Rc3.*Vc2+(-1).*Rc2.*Vc3))); ...
  2.*(Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2).*((Rc2.*Vc1+(-1).*Rc1.*Vc2).^2+( ...
  Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.*Vc3).^2).^(-1/2) ...
  .*((-1).*q1.*Rc3.*(Rc1.*Vc1+Rc2.*Vc2)+q1.*(Rc1.^2+Rc2.^2).*Vc3+ ...
  q3.*((-1).*Rc2.^2.*Vc1+(-1).*Rc3.^2.*Vc1+Rc1.*Rc2.*Vc2+Rc1.*Rc3.* ...
  Vc3)+q0.*((-1).*Rc1.*Rc2.*Vc1+Rc1.^2.*Vc2+Rc3.*(Rc3.*Vc2+(-1).* ...
  Rc2.*Vc3))),(Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2).*(2.*(q1.*Rc1.*Rc2+(-1) ...
  .*q0.*Rc1.*Rc3+q2.*(Rc2.^2+Rc3.^2)).*Vc1+(-2).*(Rc2.*(q2.*Rc1+q0.* ...
  Rc3)+q1.*(Rc1.^2+Rc3.^2)).*Vc2+2.*(q0.*(Rc1.^2+Rc2.^2)+(-1).*q2.* ...
  Rc1.*Rc3+q1.*Rc2.*Rc3).*Vc3).*((Rc2.*Vc1+(-1).*Rc1.*Vc2).^2+(Rc3.* ...
  Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.*Vc3).^2).^(-1/2),2.*( ...
  Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2).*((Rc2.*Vc1+(-1).*Rc1.*Vc2).^2+( ...
  Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.*Vc3).^2).^(-1/2) ...
  .*((-1).*q3.*Rc3.*(Rc1.*Vc1+Rc2.*Vc2)+q3.*(Rc1.^2+Rc2.^2).*Vc3+ ...
  q1.*(Rc2.^2.*Vc1+Rc3.^2.*Vc1+(-1).*Rc1.*Rc2.*Vc2+(-1).*Rc1.*Rc3.* ...
  Vc3)+q2.*((-1).*Rc1.*Rc2.*Vc1+Rc1.^2.*Vc2+Rc3.*(Rc3.*Vc2+(-1).* ...
  Rc2.*Vc3))),2.*(Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2).*(q3.*Rc1.*Rc2.*Vc1+ ...
  (-1).*q0.*(Rc2.^2+Rc3.^2).*Vc1+q0.*Rc1.*Rc2.*Vc2+(-1).*q3.*( ...
  Rc1.^2+Rc3.^2).*Vc2+(-1).*q2.*Rc3.*(Rc1.*Vc1+Rc2.*Vc2)+q2.*( ...
  Rc1.^2+Rc2.^2).*Vc3+(q0.*Rc1+q3.*Rc2).*Rc3.*Vc3).*((Rc2.*Vc1+(-1) ...
  .*Rc1.*Vc2).^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.* ...
  Vc3).^2).^(-1/2);(Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2).*(2.*(q1.*Rc1.* ...
  Rc2+(-1).*q0.*Rc1.*Rc3+q2.*(Rc2.^2+Rc3.^2)).*Vc1+(-2).*(Rc2.*(q2.* ...
  Rc1+q0.*Rc3)+q1.*(Rc1.^2+Rc3.^2)).*Vc2+2.*(q0.*(Rc1.^2+Rc2.^2)+( ...
  -1).*q2.*Rc1.*Rc3+q1.*Rc2.*Rc3).*Vc3).*((Rc2.*Vc1+(-1).*Rc1.*Vc2) ...
  .^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.*Vc3).^2).^( ...
  -1/2),(-2).*(Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2).*((Rc2.*Vc1+(-1).*Rc1.* ...
  Vc2).^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.*Vc3).^2) ...
  .^(-1/2).*((-1).*q1.*Rc3.*(Rc1.*Vc1+Rc2.*Vc2)+q1.*(Rc1.^2+Rc2.^2) ...
  .*Vc3+q3.*((-1).*Rc2.^2.*Vc1+(-1).*Rc3.^2.*Vc1+Rc1.*Rc2.*Vc2+Rc1.* ...
  Rc3.*Vc3)+q0.*((-1).*Rc1.*Rc2.*Vc1+Rc1.^2.*Vc2+Rc3.*(Rc3.*Vc2+(-1) ...
  .*Rc2.*Vc3))),2.*(Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2).*((-1).*q3.*Rc1.* ...
  Rc2.*Vc1+q0.*Rc2.^2.*Vc1+q2.*Rc1.*Rc3.*Vc1+q0.*Rc3.^2.*Vc1+q3.* ...
  Rc1.^2.*Vc2+(-1).*q0.*Rc1.*Rc2.*Vc2+q2.*Rc2.*Rc3.*Vc2+q3.*Rc3.^2.* ...
  Vc2+(-1).*(q2.*(Rc1.^2+Rc2.^2)+(q0.*Rc1+q3.*Rc2).*Rc3).*Vc3).*(( ...
  Rc2.*Vc1+(-1).*Rc1.*Vc2).^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.* ...
  Vc2+(-1).*Rc2.*Vc3).^2).^(-1/2),2.*(Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2) ...
  .*((Rc2.*Vc1+(-1).*Rc1.*Vc2).^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+( ...
  Rc3.*Vc2+(-1).*Rc2.*Vc3).^2).^(-1/2).*((-1).*q3.*Rc3.*(Rc1.*Vc1+ ...
  Rc2.*Vc2)+q3.*(Rc1.^2+Rc2.^2).*Vc3+q1.*(Rc2.^2.*Vc1+Rc3.^2.*Vc1+( ...
  -1).*Rc1.*Rc2.*Vc2+(-1).*Rc1.*Rc3.*Vc3)+q2.*((-1).*Rc1.*Rc2.*Vc1+ ...
  Rc1.^2.*Vc2+Rc3.*(Rc3.*Vc2+(-1).*Rc2.*Vc3)))];

pCb2pXstate = [pCb2pQvec, zeros(3,9)];

% ------------------------------------------------------------------------
pCb3pQvec=[2.*(q2.*Rc2.*Vc1+q3.*Rc3.*Vc1+(-1).*q2.*Rc1.*Vc2+(-1).*q0.*Rc3.* ...
  Vc2+(-1).*q3.*Rc1.*Vc3+q0.*Rc2.*Vc3).*((Rc2.*Vc1+(-1).*Rc1.*Vc2) ...
  .^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.*Vc3).^2).^( ...
  -1/2),2.*((-1).*q3.*Rc2.*Vc1+q2.*Rc3.*Vc1+q3.*Rc1.*Vc2+(-1).*q1.* ...
  Rc3.*Vc2+(-1).*q2.*Rc1.*Vc3+q1.*Rc2.*Vc3).*((Rc2.*Vc1+(-1).*Rc1.* ...
  Vc2).^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.*Vc3).^2) ...
  .^(-1/2),2.*(q0.*Rc2.*Vc1+q1.*Rc3.*Vc1+(-1).*q0.*Rc1.*Vc2+q2.* ...
  Rc3.*Vc2+(-1).*(q1.*Rc1+q2.*Rc2).*Vc3).*((Rc2.*Vc1+(-1).*Rc1.*Vc2) ...
  .^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.*Vc3).^2).^( ...
  -1/2),2.*((-1).*q1.*Rc2.*Vc1+q0.*Rc3.*Vc1+q1.*Rc1.*Vc2+q3.*Rc3.* ...
  Vc2+(-1).*(q0.*Rc1+q3.*Rc2).*Vc3).*((Rc2.*Vc1+(-1).*Rc1.*Vc2).^2+( ...
  Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.*Vc3).^2).^(-1/2); ...
  2.*((-1).*q1.*Rc2.*Vc1+q0.*Rc3.*Vc1+q1.*Rc1.*Vc2+q3.*Rc3.*Vc2+(-1) ...
  .*(q0.*Rc1+q3.*Rc2).*Vc3).*((Rc2.*Vc1+(-1).*Rc1.*Vc2).^2+(Rc3.* ...
  Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.*Vc3).^2).^(-1/2),2.*(( ...
  -1).*q0.*Rc2.*Vc1+(-1).*q1.*Rc3.*Vc1+q0.*Rc1.*Vc2+(-1).*q2.*Rc3.* ...
  Vc2+q1.*Rc1.*Vc3+q2.*Rc2.*Vc3).*((Rc2.*Vc1+(-1).*Rc1.*Vc2).^2+( ...
  Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.*Vc3).^2).^(-1/2), ...
  2.*((-1).*q3.*Rc2.*Vc1+q2.*Rc3.*Vc1+q3.*Rc1.*Vc2+(-1).*q1.*Rc3.* ...
  Vc2+(-1).*q2.*Rc1.*Vc3+q1.*Rc2.*Vc3).*((Rc2.*Vc1+(-1).*Rc1.*Vc2) ...
  .^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.*Vc3).^2).^( ...
  -1/2),2.*((-1).*q2.*Rc2.*Vc1+(-1).*q3.*Rc3.*Vc1+q2.*Rc1.*Vc2+q0.* ...
  Rc3.*Vc2+q3.*Rc1.*Vc3+(-1).*q0.*Rc2.*Vc3).*((Rc2.*Vc1+(-1).*Rc1.* ...
  Vc2).^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.*Vc3).^2) ...
  .^(-1/2);2.*((-1).*q0.*Rc2.*Vc1+(-1).*q1.*Rc3.*Vc1+q0.*Rc1.*Vc2+( ...
  -1).*q2.*Rc3.*Vc2+q1.*Rc1.*Vc3+q2.*Rc2.*Vc3).*((Rc2.*Vc1+(-1).* ...
  Rc1.*Vc2).^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.* ...
  Vc3).^2).^(-1/2),2.*(q1.*Rc2.*Vc1+(-1).*q0.*Rc3.*Vc1+(-1).*q1.* ...
  Rc1.*Vc2+(-1).*q3.*Rc3.*Vc2+q0.*Rc1.*Vc3+q3.*Rc2.*Vc3).*((Rc2.* ...
  Vc1+(-1).*Rc1.*Vc2).^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1) ...
  .*Rc2.*Vc3).^2).^(-1/2),2.*(q2.*Rc2.*Vc1+q3.*Rc3.*Vc1+(-1).*q2.* ...
  Rc1.*Vc2+(-1).*q0.*Rc3.*Vc2+(-1).*q3.*Rc1.*Vc3+q0.*Rc2.*Vc3).*(( ...
  Rc2.*Vc1+(-1).*Rc1.*Vc2).^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.* ...
  Vc2+(-1).*Rc2.*Vc3).^2).^(-1/2),2.*((-1).*q3.*Rc2.*Vc1+q2.*Rc3.* ...
  Vc1+q3.*Rc1.*Vc2+(-1).*q1.*Rc3.*Vc2+(-1).*q2.*Rc1.*Vc3+q1.*Rc2.* ...
  Vc3).*((Rc2.*Vc1+(-1).*Rc1.*Vc2).^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+( ...
  Rc3.*Vc2+(-1).*Rc2.*Vc3).^2).^(-1/2)];

pCb3pXstate = [pCb3pQvec, zeros(3,9)];

% ---------------------------------------------------------------------------
pAcc1pQvec=[2.*PD.*((const1.*(Rc1+rho1+(-1).*Rsun1)+2.*(q0.*q2+q1.*q3).*( ...
  const2.*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+ ...
  (-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).* ...
  q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*((Rc1+rho1+( ...
  -1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3) ...
  .^2).^(1/2))).*(q2.*(Rc1+rho1+(-1).*Rsun1)+(-1).*q1.*(Rc2+rho2+( ...
  -1).*Rsun2)+q0.*(Rc3+rho3+(-1).*Rsun3))+(q2.*(const2.*(2.*(q0.*q2+ ...
  q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+ ...
  rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+ ...
  rho3+(-1).*Rsun3))+(-1).*const3.*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+ ...
  rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2).^(1/2))+2.* ...
  const2.*(q0.*q2+q1.*q3).*(q2.*(Rc1+rho1+(-1).*Rsun1)+(-1).*q1.*( ...
  Rc2+rho2+(-1).*Rsun2)+q0.*(Rc3+rho3+(-1).*Rsun3))).*(2.*(q0.*q2+ ...
  q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+ ...
  rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+ ...
  rho3+(-1).*Rsun3))).*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).* ...
  Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2).^(-2),2.*PD.*((const1.*(Rc1+ ...
  rho1+(-1).*Rsun1)+2.*(q0.*q2+q1.*q3).*(const2.*(2.*(q0.*q2+q1.*q3) ...
  .*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+( ...
  -1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1) ...
  .*Rsun3))+(-1).*const3.*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1) ...
  .*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2).^(1/2))).*(q3.*(Rc1+rho1+( ...
  -1).*Rsun1)+(-1).*q0.*(Rc2+rho2+(-1).*Rsun2)+(-1).*q1.*(Rc3+rho3+( ...
  -1).*Rsun3))+(q3.*(const2.*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).* ...
  Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+ ...
  (-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))+(-1).* ...
  const3.*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+ ...
  rho3+(-1).*Rsun3).^2).^(1/2))+2.*const2.*(q0.*q2+q1.*q3).*(q3.*( ...
  Rc1+rho1+(-1).*Rsun1)+(-1).*q0.*(Rc2+rho2+(-1).*Rsun2)+(-1).*q1.*( ...
  Rc3+rho3+(-1).*Rsun3))).*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).* ...
  Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+ ...
  (-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))).*((Rc1+ ...
  rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).* ...
  Rsun3).^2).^(-2),2.*PD.*((const1.*(Rc1+rho1+(-1).*Rsun1)+2.*(q0.* ...
  q2+q1.*q3).*(const2.*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+( ...
  -2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).* ...
  q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*(( ...
  Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1) ...
  .*Rsun3).^2).^(1/2))).*(q0.*(Rc1+rho1+(-1).*Rsun1)+q3.*(Rc2+rho2+( ...
  -1).*Rsun2)+(-1).*q2.*(Rc3+rho3+(-1).*Rsun3))+(q0.*(const2.*(2.*( ...
  q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3) ...
  .*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*( ...
  Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*((Rc1+rho1+(-1).*Rsun1).^2+( ...
  Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2).^(1/2))+2.* ...
  const2.*(q0.*q2+q1.*q3).*(q0.*(Rc1+rho1+(-1).*Rsun1)+q3.*(Rc2+ ...
  rho2+(-1).*Rsun2)+(-1).*q2.*(Rc3+rho3+(-1).*Rsun3))).*(2.*(q0.*q2+ ...
  q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+ ...
  rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+ ...
  rho3+(-1).*Rsun3))).*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).* ...
  Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2).^(-2),2.*PD.*((const1.*(Rc1+ ...
  rho1+(-1).*Rsun1)+2.*(q0.*q2+q1.*q3).*(const2.*(2.*(q0.*q2+q1.*q3) ...
  .*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+( ...
  -1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1) ...
  .*Rsun3))+(-1).*const3.*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1) ...
  .*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2).^(1/2))).*(q1.*(Rc1+rho1+( ...
  -1).*Rsun1)+q2.*(Rc2+rho2+(-1).*Rsun2)+q3.*(Rc3+rho3+(-1).*Rsun3)) ...
  +(q1.*(const2.*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*( ...
  q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+( ...
  -1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*((Rc1+ ...
  rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).* ...
  Rsun3).^2).^(1/2))+2.*const2.*(q0.*q2+q1.*q3).*(q1.*(Rc1+rho1+(-1) ...
  .*Rsun1)+q2.*(Rc2+rho2+(-1).*Rsun2)+q3.*(Rc3+rho3+(-1).*Rsun3))).* ...
  (2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).* ...
  q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+ ...
  q3.^2).*(Rc3+rho3+(-1).*Rsun3))).*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+ ...
  rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2).^(-2)];

% ---------------------------------------------------------------------------
pAcc2pQvec=[(-2).*PD.*((-1).*(const1.*(Rc2+rho2+(-1).*Rsun2)+(-2).*(q0.*q1+( ...
  -1).*q2.*q3).*(const2.*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1) ...
  +(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).* ...
  q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*(( ...
  Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1) ...
  .*Rsun3).^2).^(1/2))).*(q2.*(Rc1+rho1+(-1).*Rsun1)+(-1).*q1.*(Rc2+ ...
  rho2+(-1).*Rsun2)+q0.*(Rc3+rho3+(-1).*Rsun3))+(q1.*(const2.*(2.*( ...
  q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3) ...
  .*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*( ...
  Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*((Rc1+rho1+(-1).*Rsun1).^2+( ...
  Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2).^(1/2))+2.* ...
  const2.*(q0.*q1+(-1).*q2.*q3).*(q2.*(Rc1+rho1+(-1).*Rsun1)+(-1).* ...
  q1.*(Rc2+rho2+(-1).*Rsun2)+q0.*(Rc3+rho3+(-1).*Rsun3))).*(2.*(q0.* ...
  q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*( ...
  Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+ ...
  rho3+(-1).*Rsun3))).*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).* ...
  Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2).^(-2),(-2).*PD.*((-1).*( ...
  const1.*(Rc2+rho2+(-1).*Rsun2)+(-2).*(q0.*q1+(-1).*q2.*q3).*( ...
  const2.*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+ ...
  (-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).* ...
  q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*((Rc1+rho1+( ...
  -1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3) ...
  .^2).^(1/2))).*(q3.*(Rc1+rho1+(-1).*Rsun1)+(-1).*q0.*(Rc2+rho2+( ...
  -1).*Rsun2)+(-1).*q1.*(Rc3+rho3+(-1).*Rsun3))+(q0.*(const2.*(2.*( ...
  q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3) ...
  .*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*( ...
  Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*((Rc1+rho1+(-1).*Rsun1).^2+( ...
  Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2).^(1/2))+2.* ...
  const2.*(q0.*q1+(-1).*q2.*q3).*(q3.*(Rc1+rho1+(-1).*Rsun1)+(-1).* ...
  q0.*(Rc2+rho2+(-1).*Rsun2)+(-1).*q1.*(Rc3+rho3+(-1).*Rsun3))).*( ...
  2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).* ...
  q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+ ...
  q3.^2).*(Rc3+rho3+(-1).*Rsun3))).*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+ ...
  rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2).^(-2),(-2).*PD.*(( ...
  -1).*(const1.*(Rc2+rho2+(-1).*Rsun2)+(-2).*(q0.*q1+(-1).*q2.*q3).* ...
  (const2.*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.* ...
  q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).* ...
  q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*((Rc1+rho1+( ...
  -1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3) ...
  .^2).^(1/2))).*(q0.*(Rc1+rho1+(-1).*Rsun1)+q3.*(Rc2+rho2+(-1).* ...
  Rsun2)+(-1).*q2.*(Rc3+rho3+(-1).*Rsun3))+(2.*const2.*(q0.*q1+(-1) ...
  .*q2.*q3).*(q0.*(Rc1+rho1+(-1).*Rsun1)+q3.*(Rc2+rho2+(-1).*Rsun2)+ ...
  (-1).*q2.*(Rc3+rho3+(-1).*Rsun3))+(-1).*const2.*q3.*(2.*(q0.*q2+ ...
  q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+ ...
  rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+ ...
  rho3+(-1).*Rsun3))+const3.*q3.*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+ ...
  rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2).^(1/2)).*(2.*(q0.* ...
  q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*( ...
  Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+ ...
  rho3+(-1).*Rsun3))).*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).* ...
  Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2).^(-2),(-2).*PD.*((-1).*( ...
  const1.*(Rc2+rho2+(-1).*Rsun2)+(-2).*(q0.*q1+(-1).*q2.*q3).*( ...
  const2.*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+ ...
  (-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).* ...
  q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*((Rc1+rho1+( ...
  -1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3) ...
  .^2).^(1/2))).*(q1.*(Rc1+rho1+(-1).*Rsun1)+q2.*(Rc2+rho2+(-1).* ...
  Rsun2)+q3.*(Rc3+rho3+(-1).*Rsun3))+(2.*const2.*(q0.*q1+(-1).*q2.* ...
  q3).*(q1.*(Rc1+rho1+(-1).*Rsun1)+q2.*(Rc2+rho2+(-1).*Rsun2)+q3.*( ...
  Rc3+rho3+(-1).*Rsun3))+(-1).*const2.*q2.*(2.*(q0.*q2+q1.*q3).*( ...
  Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1) ...
  .*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).* ...
  Rsun3))+const3.*q2.*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).* ...
  Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2).^(1/2)).*(2.*(q0.*q2+q1.*q3) ...
  .*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+( ...
  -1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1) ...
  .*Rsun3))).*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+( ...
  Rc3+rho3+(-1).*Rsun3).^2).^(-2)];

% ---------------------------------------------------------------------------
pAcc3pQvec=[2.*PD.*(((q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(const2.*(2.*( ...
  q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3) ...
  .*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*( ...
  Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*((Rc1+rho1+(-1).*Rsun1).^2+( ...
  Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2).^(1/2))+ ...
  const1.*(Rc3+rho3+(-1).*Rsun3)).*(q2.*(Rc1+rho1+(-1).*Rsun1)+(-1) ...
  .*q1.*(Rc2+rho2+(-1).*Rsun2)+q0.*(Rc3+rho3+(-1).*Rsun3))+(q0.*( ...
  const2.*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+ ...
  (-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).* ...
  q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*((Rc1+rho1+( ...
  -1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3) ...
  .^2).^(1/2))+const2.*(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(q2.*( ...
  Rc1+rho1+(-1).*Rsun1)+(-1).*q1.*(Rc2+rho2+(-1).*Rsun2)+q0.*(Rc3+ ...
  rho3+(-1).*Rsun3))).*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+( ...
  -2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).* ...
  q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))).*((Rc1+rho1+( ...
  -1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3) ...
  .^2).^(-2),2.*PD.*(((q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*( ...
  const2.*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+ ...
  (-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).* ...
  q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*((Rc1+rho1+( ...
  -1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3) ...
  .^2).^(1/2))+const1.*(Rc3+rho3+(-1).*Rsun3)).*(q3.*(Rc1+rho1+(-1) ...
  .*Rsun1)+(-1).*q0.*(Rc2+rho2+(-1).*Rsun2)+(-1).*q1.*(Rc3+rho3+(-1) ...
  .*Rsun3))+(const2.*(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(q3.*( ...
  Rc1+rho1+(-1).*Rsun1)+(-1).*q0.*(Rc2+rho2+(-1).*Rsun2)+(-1).*q1.*( ...
  Rc3+rho3+(-1).*Rsun3))+(-1).*const2.*q1.*(2.*(q0.*q2+q1.*q3).*( ...
  Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1) ...
  .*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).* ...
  Rsun3))+const3.*q1.*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).* ...
  Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2).^(1/2)).*(2.*(q0.*q2+q1.*q3) ...
  .*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+( ...
  -1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1) ...
  .*Rsun3))).*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+( ...
  Rc3+rho3+(-1).*Rsun3).^2).^(-2),2.*PD.*(((q0.^2+(-1).*q1.^2+(-1).* ...
  q2.^2+q3.^2).*(const2.*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1) ...
  +(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).* ...
  q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*(( ...
  Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1) ...
  .*Rsun3).^2).^(1/2))+const1.*(Rc3+rho3+(-1).*Rsun3)).*(q0.*(Rc1+ ...
  rho1+(-1).*Rsun1)+q3.*(Rc2+rho2+(-1).*Rsun2)+(-1).*q2.*(Rc3+rho3+( ...
  -1).*Rsun3))+(const2.*(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(q0.* ...
  (Rc1+rho1+(-1).*Rsun1)+q3.*(Rc2+rho2+(-1).*Rsun2)+(-1).*q2.*(Rc3+ ...
  rho3+(-1).*Rsun3))+(-1).*const2.*q2.*(2.*(q0.*q2+q1.*q3).*(Rc1+ ...
  rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).* ...
  Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).* ...
  Rsun3))+const3.*q2.*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).* ...
  Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2).^(1/2)).*(2.*(q0.*q2+q1.*q3) ...
  .*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+( ...
  -1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1) ...
  .*Rsun3))).*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+( ...
  Rc3+rho3+(-1).*Rsun3).^2).^(-2),2.*PD.*(((q0.^2+(-1).*q1.^2+(-1).* ...
  q2.^2+q3.^2).*(const2.*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1) ...
  +(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).* ...
  q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*(( ...
  Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1) ...
  .*Rsun3).^2).^(1/2))+const1.*(Rc3+rho3+(-1).*Rsun3)).*(q1.*(Rc1+ ...
  rho1+(-1).*Rsun1)+q2.*(Rc2+rho2+(-1).*Rsun2)+q3.*(Rc3+rho3+(-1).* ...
  Rsun3))+(q3.*(const2.*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+ ...
  (-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).* ...
  q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*(( ...
  Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1) ...
  .*Rsun3).^2).^(1/2))+const2.*(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2) ...
  .*(q1.*(Rc1+rho1+(-1).*Rsun1)+q2.*(Rc2+rho2+(-1).*Rsun2)+q3.*(Rc3+ ...
  rho3+(-1).*Rsun3))).*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+( ...
  -2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).* ...
  q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))).*((Rc1+rho1+( ...
  -1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3) ...
  .^2).^(-2)];

% ---------------------------------------------------------------------------
pAcc1pRhovec=[(-1).*PD.*(2.*(Rc1+rho1+(-1).*Rsun1).*(const1.*(Rc1+rho1+(-1).* ...
  Rsun1)+2.*(q0.*q2+q1.*q3).*(const2.*(2.*(q0.*q2+q1.*q3).*(Rc1+ ...
  rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).* ...
  Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).* ...
  Rsun3))+(-1).*const3.*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).* ...
  Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2).^(1/2))).*(2.*(q0.*q2+q1.*q3) ...
  .*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+( ...
  -1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1) ...
  .*Rsun3))+(const1.*(Rc1+rho1+(-1).*Rsun1).^2+2.*const2.*(q0.*q2+ ...
  q1.*q3).*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1).^2+(-2).*( ...
  q0.*q1+(-1).*q2.*q3).*(Rc1+rho1+(-1).*Rsun1).*(Rc2+rho2+(-1).* ...
  Rsun2)+(-2).*(q0.*q2+q1.*q3).*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+ ...
  rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2)+(q0.^2+(-1).* ...
  q1.^2+(-1).*q2.^2+q3.^2).*(Rc1+rho1+(-1).*Rsun1).*(Rc3+rho3+(-1).* ...
  Rsun3))+(-1).*const1.*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).* ...
  Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2)).*(2.*(q0.*q2+q1.*q3).*(Rc1+ ...
  rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).* ...
  Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).* ...
  Rsun3))+(const1.*(Rc1+rho1+(-1).*Rsun1)+2.*(q0.*q2+q1.*q3).*( ...
  const2.*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+ ...
  (-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).* ...
  q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*((Rc1+rho1+( ...
  -1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3) ...
  .^2).^(1/2))).*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1).^2+(-2) ...
  .*(q0.*q1+(-1).*q2.*q3).*(Rc1+rho1+(-1).*Rsun1).*(Rc2+rho2+(-1).* ...
  Rsun2)+(-2).*(q0.*q2+q1.*q3).*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+ ...
  rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2)+(q0.^2+(-1).* ...
  q1.^2+(-1).*q2.^2+q3.^2).*(Rc1+rho1+(-1).*Rsun1).*(Rc3+rho3+(-1).* ...
  Rsun3))).*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+( ...
  Rc3+rho3+(-1).*Rsun3).^2).^(-3),(-1).*PD.*(2.*(Rc2+rho2+(-1).* ...
  Rsun2).*(const1.*(Rc1+rho1+(-1).*Rsun1)+2.*(q0.*q2+q1.*q3).*( ...
  const2.*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+ ...
  (-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).* ...
  q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*((Rc1+rho1+( ...
  -1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3) ...
  .^2).^(1/2))).*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*( ...
  q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+( ...
  -1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))+(const1.*(Rc1+rho1+(-1) ...
  .*Rsun1).*(Rc2+rho2+(-1).*Rsun2)+2.*const2.*(q0.*q2+q1.*q3).*(2.*( ...
  q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1).*(Rc2+rho2+(-1).*Rsun2)+( ...
  -2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2).^2+2.*(q0.*q1+( ...
  -1).*q2.*q3).*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2) ...
  .^2+(Rc3+rho3+(-1).*Rsun3).^2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+ ...
  q3.^2).*(Rc2+rho2+(-1).*Rsun2).*(Rc3+rho3+(-1).*Rsun3))).*(2.*( ...
  q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3) ...
  .*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*( ...
  Rc3+rho3+(-1).*Rsun3))+(const1.*(Rc1+rho1+(-1).*Rsun1)+2.*(q0.*q2+ ...
  q1.*q3).*(const2.*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2) ...
  .*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).* ...
  q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*(( ...
  Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1) ...
  .*Rsun3).^2).^(1/2))).*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1) ...
  .*(Rc2+rho2+(-1).*Rsun2)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+( ...
  -1).*Rsun2).^2+2.*(q0.*q1+(-1).*q2.*q3).*((Rc1+rho1+(-1).*Rsun1) ...
  .^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2)+(q0.^2+( ...
  -1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc2+rho2+(-1).*Rsun2).*(Rc3+rho3+( ...
  -1).*Rsun3))).*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2) ...
  .^2+(Rc3+rho3+(-1).*Rsun3).^2).^(-3),(-1).*PD.*((2.*(q0.*q2+q1.* ...
  q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+ ...
  rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+ ...
  rho3+(-1).*Rsun3)).*(2.*const2.*(q0.*q2+q1.*q3).*((-1).*(q0.^2+( ...
  -1).*q1.^2+(-1).*q2.^2+q3.^2).*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+ ...
  rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2)+2.*(q0.*q2+q1.*q3) ...
  .*(Rc1+rho1+(-1).*Rsun1).*(Rc3+rho3+(-1).*Rsun3)+(-2).*(q0.*q1+( ...
  -1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2).*(Rc3+rho3+(-1).*Rsun3)+( ...
  q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3).^2)+ ...
  const1.*(Rc1+rho1+(-1).*Rsun1).*(Rc3+rho3+(-1).*Rsun3))+(const1.*( ...
  Rc1+rho1+(-1).*Rsun1)+2.*(q0.*q2+q1.*q3).*(const2.*(2.*(q0.*q2+ ...
  q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+ ...
  rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+ ...
  rho3+(-1).*Rsun3))+(-1).*const3.*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+ ...
  rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2).^(1/2))).*((-1).*( ...
  q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*((Rc1+rho1+(-1).*Rsun1).^2+( ...
  Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2)+2.*(q0.*q2+ ...
  q1.*q3).*(Rc1+rho1+(-1).*Rsun1).*(Rc3+rho3+(-1).*Rsun3)+(-2).*( ...
  q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2).*(Rc3+rho3+(-1).* ...
  Rsun3)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).* ...
  Rsun3).^2)+2.*(const1.*(Rc1+rho1+(-1).*Rsun1)+2.*(q0.*q2+q1.*q3).* ...
  (const2.*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.* ...
  q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).* ...
  q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*((Rc1+rho1+( ...
  -1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3) ...
  .^2).^(1/2))).*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*( ...
  q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+( ...
  -1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3)).*(Rc3+rho3+(-1).*Rsun3) ...
  ).*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+ ...
  (-1).*Rsun3).^2).^(-3)];

% ---------------------------------------------------------------------------
pAcc2pRhovec=[(-1).*PD.*(2.*(Rc1+rho1+(-1).*Rsun1).*(const1.*(Rc2+rho2+(-1).* ...
  Rsun2)+(-2).*(q0.*q1+(-1).*q2.*q3).*(const2.*(2.*(q0.*q2+q1.*q3).* ...
  (Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1) ...
  .*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).* ...
  Rsun3))+(-1).*const3.*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).* ...
  Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2).^(1/2))).*(2.*(q0.*q2+q1.*q3) ...
  .*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+( ...
  -1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1) ...
  .*Rsun3))+(const1.*(Rc1+rho1+(-1).*Rsun1).*(Rc2+rho2+(-1).*Rsun2)+ ...
  (-2).*const2.*(q0.*q1+(-1).*q2.*q3).*(2.*(q0.*q2+q1.*q3).*(Rc1+ ...
  rho1+(-1).*Rsun1).^2+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc1+rho1+(-1).* ...
  Rsun1).*(Rc2+rho2+(-1).*Rsun2)+(-2).*(q0.*q2+q1.*q3).*((Rc1+rho1+( ...
  -1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3) ...
  .^2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc1+rho1+(-1).*Rsun1) ...
  .*(Rc3+rho3+(-1).*Rsun3))).*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).* ...
  Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+ ...
  (-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))+(const1.*( ...
  Rc2+rho2+(-1).*Rsun2)+(-2).*(q0.*q1+(-1).*q2.*q3).*(const2.*(2.*( ...
  q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3) ...
  .*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*( ...
  Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*((Rc1+rho1+(-1).*Rsun1).^2+( ...
  Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2).^(1/2))).*(2.* ...
  (q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1).^2+(-2).*(q0.*q1+(-1).* ...
  q2.*q3).*(Rc1+rho1+(-1).*Rsun1).*(Rc2+rho2+(-1).*Rsun2)+(-2).*( ...
  q0.*q2+q1.*q3).*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2) ...
  .^2+(Rc3+rho3+(-1).*Rsun3).^2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+ ...
  q3.^2).*(Rc1+rho1+(-1).*Rsun1).*(Rc3+rho3+(-1).*Rsun3))).*((Rc1+ ...
  rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).* ...
  Rsun3).^2).^(-3),(-1).*PD.*(2.*(Rc2+rho2+(-1).*Rsun2).*(const1.*( ...
  Rc2+rho2+(-1).*Rsun2)+(-2).*(q0.*q1+(-1).*q2.*q3).*(const2.*(2.*( ...
  q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3) ...
  .*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*( ...
  Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*((Rc1+rho1+(-1).*Rsun1).^2+( ...
  Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2).^(1/2))).*(2.* ...
  (q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.* ...
  q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2) ...
  .*(Rc3+rho3+(-1).*Rsun3))+(const1.*(Rc2+rho2+(-1).*Rsun2).^2+(-2) ...
  .*const2.*(q0.*q1+(-1).*q2.*q3).*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+( ...
  -1).*Rsun1).*(Rc2+rho2+(-1).*Rsun2)+(-2).*(q0.*q1+(-1).*q2.*q3).*( ...
  Rc2+rho2+(-1).*Rsun2).^2+2.*(q0.*q1+(-1).*q2.*q3).*((Rc1+rho1+(-1) ...
  .*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2)+( ...
  q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc2+rho2+(-1).*Rsun2).*( ...
  Rc3+rho3+(-1).*Rsun3))+(-1).*const1.*((Rc1+rho1+(-1).*Rsun1).^2+( ...
  Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2)).*(2.*(q0.*q2+ ...
  q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+ ...
  rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+ ...
  rho3+(-1).*Rsun3))+(const1.*(Rc2+rho2+(-1).*Rsun2)+(-2).*(q0.*q1+( ...
  -1).*q2.*q3).*(const2.*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1) ...
  +(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).* ...
  q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*(( ...
  Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1) ...
  .*Rsun3).^2).^(1/2))).*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1) ...
  .*(Rc2+rho2+(-1).*Rsun2)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+( ...
  -1).*Rsun2).^2+2.*(q0.*q1+(-1).*q2.*q3).*((Rc1+rho1+(-1).*Rsun1) ...
  .^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2)+(q0.^2+( ...
  -1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc2+rho2+(-1).*Rsun2).*(Rc3+rho3+( ...
  -1).*Rsun3))).*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2) ...
  .^2+(Rc3+rho3+(-1).*Rsun3).^2).^(-3),(-1).*PD.*((2.*(q0.*q2+q1.* ...
  q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+ ...
  rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+ ...
  rho3+(-1).*Rsun3)).*((-2).*const2.*(q0.*q1+(-1).*q2.*q3).*((-1).*( ...
  q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*((Rc1+rho1+(-1).*Rsun1).^2+( ...
  Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2)+2.*(q0.*q2+ ...
  q1.*q3).*(Rc1+rho1+(-1).*Rsun1).*(Rc3+rho3+(-1).*Rsun3)+(-2).*( ...
  q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2).*(Rc3+rho3+(-1).* ...
  Rsun3)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).* ...
  Rsun3).^2)+const1.*(Rc2+rho2+(-1).*Rsun2).*(Rc3+rho3+(-1).*Rsun3)) ...
  +(const1.*(Rc2+rho2+(-1).*Rsun2)+(-2).*(q0.*q1+(-1).*q2.*q3).*( ...
  const2.*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+ ...
  (-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).* ...
  q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*((Rc1+rho1+( ...
  -1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3) ...
  .^2).^(1/2))).*((-1).*(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(( ...
  Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1) ...
  .*Rsun3).^2)+2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1).*(Rc3+ ...
  rho3+(-1).*Rsun3)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).* ...
  Rsun2).*(Rc3+rho3+(-1).*Rsun3)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+ ...
  q3.^2).*(Rc3+rho3+(-1).*Rsun3).^2)+2.*(const1.*(Rc2+rho2+(-1).* ...
  Rsun2)+(-2).*(q0.*q1+(-1).*q2.*q3).*(const2.*(2.*(q0.*q2+q1.*q3).* ...
  (Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1) ...
  .*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).* ...
  Rsun3))+(-1).*const3.*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).* ...
  Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2).^(1/2))).*(2.*(q0.*q2+q1.*q3) ...
  .*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+( ...
  -1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1) ...
  .*Rsun3)).*(Rc3+rho3+(-1).*Rsun3)).*((Rc1+rho1+(-1).*Rsun1).^2+( ...
  Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2).^(-3)];

% ---------------------------------------------------------------------------
pAcc3pRhovec=[(-1).*PD.*(2.*(Rc1+rho1+(-1).*Rsun1).*((q0.^2+(-1).*q1.^2+(-1).* ...
  q2.^2+q3.^2).*(const2.*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1) ...
  +(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).* ...
  q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*(( ...
  Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1) ...
  .*Rsun3).^2).^(1/2))+const1.*(Rc3+rho3+(-1).*Rsun3)).*(2.*(q0.*q2+ ...
  q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+ ...
  rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+ ...
  rho3+(-1).*Rsun3))+(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+( ...
  -2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).* ...
  q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3)).*(const2.*( ...
  q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(2.*(q0.*q2+q1.*q3).*(Rc1+ ...
  rho1+(-1).*Rsun1).^2+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc1+rho1+(-1).* ...
  Rsun1).*(Rc2+rho2+(-1).*Rsun2)+(-2).*(q0.*q2+q1.*q3).*((Rc1+rho1+( ...
  -1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3) ...
  .^2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc1+rho1+(-1).*Rsun1) ...
  .*(Rc3+rho3+(-1).*Rsun3))+const1.*(Rc1+rho1+(-1).*Rsun1).*(Rc3+ ...
  rho3+(-1).*Rsun3))+((q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*( ...
  const2.*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+ ...
  (-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).* ...
  q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*((Rc1+rho1+( ...
  -1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3) ...
  .^2).^(1/2))+const1.*(Rc3+rho3+(-1).*Rsun3)).*(2.*(q0.*q2+q1.*q3) ...
  .*(Rc1+rho1+(-1).*Rsun1).^2+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc1+ ...
  rho1+(-1).*Rsun1).*(Rc2+rho2+(-1).*Rsun2)+(-2).*(q0.*q2+q1.*q3).*( ...
  (Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1) ...
  .*Rsun3).^2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc1+rho1+(-1) ...
  .*Rsun1).*(Rc3+rho3+(-1).*Rsun3))).*((Rc1+rho1+(-1).*Rsun1).^2+( ...
  Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2).^(-3),(-1).* ...
  PD.*(2.*(Rc2+rho2+(-1).*Rsun2).*((q0.^2+(-1).*q1.^2+(-1).*q2.^2+ ...
  q3.^2).*(const2.*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2) ...
  .*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).* ...
  q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*(( ...
  Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1) ...
  .*Rsun3).^2).^(1/2))+const1.*(Rc3+rho3+(-1).*Rsun3)).*(2.*(q0.*q2+ ...
  q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+ ...
  rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+ ...
  rho3+(-1).*Rsun3))+(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+( ...
  -2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).* ...
  q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3)).*(const2.*( ...
  q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(2.*(q0.*q2+q1.*q3).*(Rc1+ ...
  rho1+(-1).*Rsun1).*(Rc2+rho2+(-1).*Rsun2)+(-2).*(q0.*q1+(-1).*q2.* ...
  q3).*(Rc2+rho2+(-1).*Rsun2).^2+2.*(q0.*q1+(-1).*q2.*q3).*((Rc1+ ...
  rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).* ...
  Rsun3).^2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc2+rho2+(-1).* ...
  Rsun2).*(Rc3+rho3+(-1).*Rsun3))+const1.*(Rc2+rho2+(-1).*Rsun2).*( ...
  Rc3+rho3+(-1).*Rsun3))+((q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*( ...
  const2.*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+ ...
  (-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).* ...
  q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*((Rc1+rho1+( ...
  -1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3) ...
  .^2).^(1/2))+const1.*(Rc3+rho3+(-1).*Rsun3)).*(2.*(q0.*q2+q1.*q3) ...
  .*(Rc1+rho1+(-1).*Rsun1).*(Rc2+rho2+(-1).*Rsun2)+(-2).*(q0.*q1+( ...
  -1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2).^2+2.*(q0.*q1+(-1).*q2.*q3).* ...
  ((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+( ...
  -1).*Rsun3).^2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc2+rho2+( ...
  -1).*Rsun2).*(Rc3+rho3+(-1).*Rsun3))).*((Rc1+rho1+(-1).*Rsun1).^2+ ...
  (Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2).^(-3),(-1).* ...
  PD.*((2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+( ...
  -1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).* ...
  q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3)).*((-1).*const1.*((Rc1+rho1+( ...
  -1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3) ...
  .^2)+const2.*(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*((-1).*(q0.^2+ ...
  (-1).*q1.^2+(-1).*q2.^2+q3.^2).*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+ ...
  rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2)+2.*(q0.*q2+q1.*q3) ...
  .*(Rc1+rho1+(-1).*Rsun1).*(Rc3+rho3+(-1).*Rsun3)+(-2).*(q0.*q1+( ...
  -1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2).*(Rc3+rho3+(-1).*Rsun3)+( ...
  q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3).^2)+ ...
  const1.*(Rc3+rho3+(-1).*Rsun3).^2)+((q0.^2+(-1).*q1.^2+(-1).* ...
  q2.^2+q3.^2).*(const2.*(2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1) ...
  +(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).* ...
  q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*(( ...
  Rc1+rho1+(-1).*Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1) ...
  .*Rsun3).^2).^(1/2))+const1.*(Rc3+rho3+(-1).*Rsun3)).*((-1).*( ...
  q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*((Rc1+rho1+(-1).*Rsun1).^2+( ...
  Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2)+2.*(q0.*q2+ ...
  q1.*q3).*(Rc1+rho1+(-1).*Rsun1).*(Rc3+rho3+(-1).*Rsun3)+(-2).*( ...
  q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).*Rsun2).*(Rc3+rho3+(-1).* ...
  Rsun3)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).* ...
  Rsun3).^2)+2.*((q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(const2.*( ...
  2.*(q0.*q2+q1.*q3).*(Rc1+rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).* ...
  q2.*q3).*(Rc2+rho2+(-1).*Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+ ...
  q3.^2).*(Rc3+rho3+(-1).*Rsun3))+(-1).*const3.*((Rc1+rho1+(-1).* ...
  Rsun1).^2+(Rc2+rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2).^( ...
  1/2))+const1.*(Rc3+rho3+(-1).*Rsun3)).*(2.*(q0.*q2+q1.*q3).*(Rc1+ ...
  rho1+(-1).*Rsun1)+(-2).*(q0.*q1+(-1).*q2.*q3).*(Rc2+rho2+(-1).* ...
  Rsun2)+(q0.^2+(-1).*q1.^2+(-1).*q2.^2+q3.^2).*(Rc3+rho3+(-1).* ...
  Rsun3)).*(Rc3+rho3+(-1).*Rsun3)).*((Rc1+rho1+(-1).*Rsun1).^2+(Rc2+ ...
  rho2+(-1).*Rsun2).^2+(Rc3+rho3+(-1).*Rsun3).^2).^(-3)];

% ---------------------------------------------------------------------------
DAccDQvec   = [pAcc1pQvec; pAcc2pQvec; pAcc3pQvec];
DAccDrho    = [pAcc1pRhovec; pAcc2pRhovec; pAcc3pRhovec];
DAccDXstate = [DAccDQvec, zeros(3), DAccDrho, zeros(3)];
PartialDelAccsrp_PartialXstate = CBmatrix*DAccDXstate + ...
    [Acc'*pCb1pXstate; Acc'*pCb2pXstate; Acc'*pCb3pXstate];


%% Partial of the relaive gravity froce on the deputy plate

pDelAccgprho = [(-1).*mu_Earth.*((Rc2+rho2).^2+(Rc3+rho3).^2).*((Rc1+ ...
  rho1).^2+(Rc2+rho2).^2+(Rc3+rho3).^2).^(-3/2),mu_Earth.*(Rc1+rho1) ...
  .*(Rc2+rho2).*((Rc1+rho1).^2+(Rc2+rho2).^2+(Rc3+rho3).^2).^(-3/2), ...
  mu_Earth.*(Rc1+rho1).*(Rc3+rho3).*((Rc1+rho1).^2+(Rc2+rho2).^2+( ...
  Rc3+rho3).^2).^(-3/2);mu_Earth.*(Rc1+rho1).*(Rc2+rho2).*((Rc1+rho1) ...
  .^2+(Rc2+rho2).^2+(Rc3+rho3).^2).^(-3/2),(-1).*mu_Earth.*((Rc1+ ...
  rho1).^2+(Rc3+rho3).^2).*((Rc1+rho1).^2+(Rc2+rho2).^2+(Rc3+rho3) ...
  .^2).^(-3/2),mu_Earth.*(Rc2+rho2).*(Rc3+rho3).*((Rc1+rho1).^2+(Rc2+ ...
  rho2).^2+(Rc3+rho3).^2).^(-3/2);mu_Earth.*(Rc1+rho1).*(Rc3+rho3).*( ...
  (Rc1+rho1).^2+(Rc2+rho2).^2+(Rc3+rho3).^2).^(-3/2),mu_Earth.*(Rc2+ ...
  rho2).*(Rc3+rho3).*((Rc1+rho1).^2+(Rc2+rho2).^2+(Rc3+rho3).^2).^( ...
  -3/2),(-1).*mu_Earth.*((Rc1+rho1).^2+(Rc2+rho2).^2).*((Rc1+rho1) ...
  .^2+(Rc2+rho2).^2+(Rc3+rho3).^2).^(-3/2)];
PartialDelGrav_PartialXstate = [zeros(3,7), pDelAccgprho, zeros(3)];


%% Partial of the coriolis effect on the deputy plate

pDelCoriolisprhorhodot = [omegaCh2.^2+omegaCh3.^2,(-1).*omegaCh1.*omegaCh2+omegaCh3,(-1).* ...
  omegaCh2+(-1).*omegaCh1.*omegaCh3,0,2.*omegaChdot3,(-2).* ...
  omegaChdot2;(-1).*omegaCh1.*omegaCh2+(-1).*omegaCh3,omegaCh1.^2+ ...
  omegaCh3.^2,omegaCh1+(-1).*omegaCh2.*omegaCh3,(-2).*omegaChdot3,0, ...
  2.*omegaChdot1;omegaCh2+(-1).*omegaCh1.*omegaCh3,(-1).*omegaCh1+( ...
  -1).*omegaCh2.*omegaCh3,omegaCh1.^2+omegaCh2.^2,2.*omegaChdot2,( ...
  -2).*omegaChdot1,0];
PartialDelCoriolis_PartialXstate = [zeros(3,7), pDelCoriolisprhorhodot];


%% Partial of the accelerations on the deputy plate

PartialRelAcceleration  = PartialDelGrav_PartialXstate + ...
    PartialDelAccsrp_PartialXstate + PartialDelCoriolis_PartialXstate;


%% Partial of the relative velocity of the deputy plate

PartialRelVelocity = [zeros(3,10), eye(3)];

%% Partial of angular velocity
PartialAngularVel=[0,0,0,0,0,i1.^(-1).*(i2+(-1).*i3).*omg3,i1.^(-1).*(i2+(-1).*i3).* ...
  omg2;0,0,0,0,i2.^(-1).*((-1).*i1+i3).*omg3,0,i2.^(-1).*((-1).*i1+ ...
  i3).*omg1;0,0,0,0,(i1+(-1).*i2).*i3.^(-1).*omg2,(i1+(-1).*i2).* ...
  i3.^(-1).*omg1,0];

PartialAngularVel = [PartialAngularVel, zeros(3,6)];

%% Partial of MRPs

PartialQdot=[0,(-1/2).*omg1,(-1/2).*omg2,(-1/2).*omg3,(-1/2).*q1,(-1/2).*q2,( ...
  -1/2).*q3;(1/2).*omg1,0,(1/2).*omg3,(-1/2).*omg2,(1/2).*q0,(-1/2) ...
  .*q3,(1/2).*q2;(1/2).*omg2,(-1/2).*omg3,0,(1/2).*omg1,(1/2).*q3,( ...
  1/2).*q0,(-1/2).*q1;(1/2).*omg3,(1/2).*omg2,(-1/2).*omg1,0,(-1/2) ...
  .*q2,(1/2).*q1,(1/2).*q0];


PartialQdot = [PartialQdot, zeros(4,6)];

%% Partial of Fd with respect to the state vector

PartialFd = [PartialQdot; PartialAngularVel; PartialRelVelocity; PartialRelAcceleration];














