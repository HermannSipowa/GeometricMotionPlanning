function [PartialFd] = Partial_Fd_Quaternion()
% [PartialFd] = Partial_Fd_Quaternion(t, Xaug, Target, Chasser)
%% Collecting relevant quantities
Target_States = Xaug(1:6,:); 
q_Chasser = Xaug(7:10,1)./norm(Xaug(7:10,:));
Omega_Chasser_body = Xaug(11:13,:);
rho_aug  = Xaug(14:19,:);

r_target = Target_States(1:3,:); v_target = Target_States(4:6,:);
rt_norm = norm(r_target);
rho = rho_aug(1:3,:); rho_prime = rho_aug(4:6,:);
r_c = [rt_norm+rho(1) rho(2) rho(3)]'; rc_norm = norm(r_c); % RIC position of the chasser
TN = DCM(r_target,v_target); % DCM's between target's RIC frame and ECI frame
rDeputy = TN\r_c; % ECI position of the chasser



%%
Rc1 = r_target(1,:); Rc2 = r_target(2,:); Rc3 = r_target(3,:);
Vc1 = v_target(1,:); Vc2 = v_target(2,:); Vc3 = v_target(3,:);
q0 = q_Chasser(1,:); q1 = q_Chasser(2,:); q2 = q_Chasser(3,:); q3 = q_Chasser(4,:);
rSun = 10*rand(3,1);
CBmatrix = rand(3);
rSunDeputy = 2*rand(3,1);
n3Vec = rand(3,1);
C1 = 0.1; C2 = 0.3; C3 = 0.6;
rho1 = rho(1); rho2 = rho(2); rho3 = rho(3);
omegaCh1 = 1; omegaCh2 = .3; omegaCh3 = .5;
omegaChdot1 = 1.1; omegaChdot2 = 1.6; omegaChdot3 = 2.3;
omg1 = Omega_Chasser_body(1,:); omg2 = Omega_Chasser_body(2,:); omg3 = Omega_Chasser_body(3,:); 
muEarth = 1000;
PD = 100;
Acc = rand(3,1);
i1 = 1; i2 = 2; i3 = 3;

%%
% Rc1 = 10; Rc2 = 21; Rc3 = 31;
% Vc1 = -3; Vc2 = -1.5; Vc3 = 1.1;
% q0 = .4; q1 = .2; q2 = .1; q3 = .5;
% rSun = 10*rand(3,1);
% CBmatrix = rand(3);
% rDeputy = 5*rand(3,1);
% rSunDeputy = 2*rand(3,1);
% n3Vec = rand(3,1);
% C1 = 0.1; C2 = 0.3; C3 = 0.6;
% rho1 = 1.1; rho2 = 2.1; rho3 = 2.3;
% omegaCh1 = 1; omegaCh2 = .3; omegaCh3 = .5;
% omegaChdot1 = 1.1; omegaChdot2 = 1.6; omegaChdot3 = 2.3;
% omg1 = 2.1; omg2 = 1.2; omg3 = 3.5; 
% muEarth = 1000;
% PD = 100;
% Acc = rand(3,1);
% i1 = 1; i2 = 2; i3 = 3;


%% % Partial of the SRP froce on the deputy plate (as seen in chief LVLH frame)
% ------------------------------------------------------------------------
pCb1pQvec=[2.*(q0.*Rc1+q3.*Rc2+(-1).*q2.*Rc3).*(Rc1.^2+Rc2.^2+Rc3.^2).^( ...
  -1/2),2.*(q1.*Rc1+q2.*Rc2+q3.*Rc3).*(Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2) ...
  ,(-2).*(q2.*Rc1+(-1).*q1.*Rc2+q0.*Rc3).*(Rc1.^2+Rc2.^2+Rc3.^2).^( ...
  -1/2),2.*((-1).*q3.*Rc1+q0.*Rc2+q1.*Rc3).*(Rc1.^2+Rc2.^2+Rc3.^2) ...
  .^(-1/2);2.*((-1).*q3.*Rc1+q0.*Rc2+q1.*Rc3).*(Rc1.^2+Rc2.^2+ ...
  Rc3.^2).^(-1/2),2.*(q2.*Rc1+(-1).*q1.*Rc2+q0.*Rc3).*(Rc1.^2+ ...
  Rc2.^2+Rc3.^2).^(-1/2),2.*(q1.*Rc1+q2.*Rc2+q3.*Rc3).*(Rc1.^2+ ...
  Rc2.^2+Rc3.^2).^(-1/2),(-2).*(q0.*Rc1+q3.*Rc2+(-1).*q2.*Rc3).*( ...
  Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2);2.*(q2.*Rc1+(-1).*q1.*Rc2+q0.*Rc3).* ...
  (Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2),(-2).*((-1).*q3.*Rc1+q0.*Rc2+q1.* ...
  Rc3).*(Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2),2.*(q0.*Rc1+q3.*Rc2+(-1).* ...
  q2.*Rc3).*(Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2),2.*(q1.*Rc1+q2.*Rc2+q3.* ...
  Rc3).*(Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2)];


pCb1pXstate = [pCb1pQvec, zeros(3,9)];

% ------------------------------------------------------------------------
pCb2pQvec=[2.*(Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2).*((-1).*q3.*Rc1.*Rc2.*Vc1+q0.* ...
  Rc2.^2.*Vc1+q2.*Rc1.*Rc3.*Vc1+q0.*Rc3.^2.*Vc1+q3.*Rc1.^2.*Vc2+(-1) ...
  .*q0.*Rc1.*Rc2.*Vc2+q2.*Rc2.*Rc3.*Vc2+q3.*Rc3.^2.*Vc2+(-1).*(q2.*( ...
  Rc1.^2+Rc2.^2)+(q0.*Rc1+q3.*Rc2).*Rc3).*Vc3).*((Rc2.*Vc1+(-1).* ...
  Rc1.*Vc2).^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.* ...
  Vc3).^2).^(-1/2),2.*(Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2).*((Rc2.*Vc1+( ...
  -1).*Rc1.*Vc2).^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).* ...
  Rc2.*Vc3).^2).^(-1/2).*((-1).*q3.*Rc3.*(Rc1.*Vc1+Rc2.*Vc2)+q3.*( ...
  Rc1.^2+Rc2.^2).*Vc3+q1.*(Rc2.^2.*Vc1+Rc3.^2.*Vc1+(-1).*Rc1.*Rc2.* ...
  Vc2+(-1).*Rc1.*Rc3.*Vc3)+q2.*((-1).*Rc1.*Rc2.*Vc1+Rc1.^2.*Vc2+ ...
  Rc3.*(Rc3.*Vc2+(-1).*Rc2.*Vc3))),2.*(Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2) ...
  .*((Rc2.*Vc1+(-1).*Rc1.*Vc2).^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+( ...
  Rc3.*Vc2+(-1).*Rc2.*Vc3).^2).^(-1/2).*(q0.*Rc3.*(Rc1.*Vc1+Rc2.* ...
  Vc2)+(-1).*q0.*(Rc1.^2+Rc2.^2).*Vc3+q2.*((-1).*Rc2.^2.*Vc1+(-1).* ...
  Rc3.^2.*Vc1+Rc1.*Rc2.*Vc2+Rc1.*Rc3.*Vc3)+q1.*((-1).*Rc1.*Rc2.*Vc1+ ...
  Rc1.^2.*Vc2+Rc3.*(Rc3.*Vc2+(-1).*Rc2.*Vc3))),2.*(Rc1.^2+Rc2.^2+ ...
  Rc3.^2).^(-1/2).*((Rc2.*Vc1+(-1).*Rc1.*Vc2).^2+(Rc3.*Vc1+(-1).* ...
  Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.*Vc3).^2).^(-1/2).*((-1).*q1.* ...
  Rc3.*(Rc1.*Vc1+Rc2.*Vc2)+q1.*(Rc1.^2+Rc2.^2).*Vc3+q3.*((-1).* ...
  Rc2.^2.*Vc1+(-1).*Rc3.^2.*Vc1+Rc1.*Rc2.*Vc2+Rc1.*Rc3.*Vc3)+q0.*(( ...
  -1).*Rc1.*Rc2.*Vc1+Rc1.^2.*Vc2+Rc3.*(Rc3.*Vc2+(-1).*Rc2.*Vc3))); ...
  2.*(Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2).*((Rc2.*Vc1+(-1).*Rc1.*Vc2).^2+( ...
  Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.*Vc3).^2).^(-1/2) ...
  .*((-1).*q1.*Rc3.*(Rc1.*Vc1+Rc2.*Vc2)+q1.*(Rc1.^2+Rc2.^2).*Vc3+ ...
  q3.*((-1).*Rc2.^2.*Vc1+(-1).*Rc3.^2.*Vc1+Rc1.*Rc2.*Vc2+Rc1.*Rc3.* ...
  Vc3)+q0.*((-1).*Rc1.*Rc2.*Vc1+Rc1.^2.*Vc2+Rc3.*(Rc3.*Vc2+(-1).* ...
  Rc2.*Vc3))),(Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2).*(2.*(q1.*Rc1.*Rc2+(-1) ...
  .*q0.*Rc1.*Rc3+q2.*(Rc2.^2+Rc3.^2)).*Vc1+(-2).*(Rc2.*(q2.*Rc1+q0.* ...
  Rc3)+q1.*(Rc1.^2+Rc3.^2)).*Vc2+2.*(q0.*(Rc1.^2+Rc2.^2)+(-1).*q2.* ...
  Rc1.*Rc3+q1.*Rc2.*Rc3).*Vc3).*((Rc2.*Vc1+(-1).*Rc1.*Vc2).^2+(Rc3.* ...
  Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.*Vc3).^2).^(-1/2),2.*( ...
  Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2).*((Rc2.*Vc1+(-1).*Rc1.*Vc2).^2+( ...
  Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.*Vc3).^2).^(-1/2) ...
  .*((-1).*q3.*Rc3.*(Rc1.*Vc1+Rc2.*Vc2)+q3.*(Rc1.^2+Rc2.^2).*Vc3+ ...
  q1.*(Rc2.^2.*Vc1+Rc3.^2.*Vc1+(-1).*Rc1.*Rc2.*Vc2+(-1).*Rc1.*Rc3.* ...
  Vc3)+q2.*((-1).*Rc1.*Rc2.*Vc1+Rc1.^2.*Vc2+Rc3.*(Rc3.*Vc2+(-1).* ...
  Rc2.*Vc3))),2.*(Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2).*(q3.*Rc1.*Rc2.*Vc1+ ...
  (-1).*q0.*(Rc2.^2+Rc3.^2).*Vc1+q0.*Rc1.*Rc2.*Vc2+(-1).*q3.*( ...
  Rc1.^2+Rc3.^2).*Vc2+(-1).*q2.*Rc3.*(Rc1.*Vc1+Rc2.*Vc2)+q2.*( ...
  Rc1.^2+Rc2.^2).*Vc3+(q0.*Rc1+q3.*Rc2).*Rc3.*Vc3).*((Rc2.*Vc1+(-1) ...
  .*Rc1.*Vc2).^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.* ...
  Vc3).^2).^(-1/2);(Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2).*(2.*(q1.*Rc1.* ...
  Rc2+(-1).*q0.*Rc1.*Rc3+q2.*(Rc2.^2+Rc3.^2)).*Vc1+(-2).*(Rc2.*(q2.* ...
  Rc1+q0.*Rc3)+q1.*(Rc1.^2+Rc3.^2)).*Vc2+2.*(q0.*(Rc1.^2+Rc2.^2)+( ...
  -1).*q2.*Rc1.*Rc3+q1.*Rc2.*Rc3).*Vc3).*((Rc2.*Vc1+(-1).*Rc1.*Vc2) ...
  .^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.*Vc3).^2).^( ...
  -1/2),(-2).*(Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2).*((Rc2.*Vc1+(-1).*Rc1.* ...
  Vc2).^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.*Vc3).^2) ...
  .^(-1/2).*((-1).*q1.*Rc3.*(Rc1.*Vc1+Rc2.*Vc2)+q1.*(Rc1.^2+Rc2.^2) ...
  .*Vc3+q3.*((-1).*Rc2.^2.*Vc1+(-1).*Rc3.^2.*Vc1+Rc1.*Rc2.*Vc2+Rc1.* ...
  Rc3.*Vc3)+q0.*((-1).*Rc1.*Rc2.*Vc1+Rc1.^2.*Vc2+Rc3.*(Rc3.*Vc2+(-1) ...
  .*Rc2.*Vc3))),2.*(Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2).*((-1).*q3.*Rc1.* ...
  Rc2.*Vc1+q0.*Rc2.^2.*Vc1+q2.*Rc1.*Rc3.*Vc1+q0.*Rc3.^2.*Vc1+q3.* ...
  Rc1.^2.*Vc2+(-1).*q0.*Rc1.*Rc2.*Vc2+q2.*Rc2.*Rc3.*Vc2+q3.*Rc3.^2.* ...
  Vc2+(-1).*(q2.*(Rc1.^2+Rc2.^2)+(q0.*Rc1+q3.*Rc2).*Rc3).*Vc3).*(( ...
  Rc2.*Vc1+(-1).*Rc1.*Vc2).^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.* ...
  Vc2+(-1).*Rc2.*Vc3).^2).^(-1/2),2.*(Rc1.^2+Rc2.^2+Rc3.^2).^(-1/2) ...
  .*((Rc2.*Vc1+(-1).*Rc1.*Vc2).^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+( ...
  Rc3.*Vc2+(-1).*Rc2.*Vc3).^2).^(-1/2).*((-1).*q3.*Rc3.*(Rc1.*Vc1+ ...
  Rc2.*Vc2)+q3.*(Rc1.^2+Rc2.^2).*Vc3+q1.*(Rc2.^2.*Vc1+Rc3.^2.*Vc1+( ...
  -1).*Rc1.*Rc2.*Vc2+(-1).*Rc1.*Rc3.*Vc3)+q2.*((-1).*Rc1.*Rc2.*Vc1+ ...
  Rc1.^2.*Vc2+Rc3.*(Rc3.*Vc2+(-1).*Rc2.*Vc3)))];

pCb2pXstate = [pCb2pQvec, zeros(3,9)];

% ------------------------------------------------------------------------
pCb3pQvec=[2.*(q2.*Rc2.*Vc1+q3.*Rc3.*Vc1+(-1).*q2.*Rc1.*Vc2+(-1).*q0.*Rc3.* ...
  Vc2+(-1).*q3.*Rc1.*Vc3+q0.*Rc2.*Vc3).*((Rc2.*Vc1+(-1).*Rc1.*Vc2) ...
  .^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.*Vc3).^2).^( ...
  -1/2),2.*((-1).*q3.*Rc2.*Vc1+q2.*Rc3.*Vc1+q3.*Rc1.*Vc2+(-1).*q1.* ...
  Rc3.*Vc2+(-1).*q2.*Rc1.*Vc3+q1.*Rc2.*Vc3).*((Rc2.*Vc1+(-1).*Rc1.* ...
  Vc2).^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.*Vc3).^2) ...
  .^(-1/2),2.*(q0.*Rc2.*Vc1+q1.*Rc3.*Vc1+(-1).*q0.*Rc1.*Vc2+q2.* ...
  Rc3.*Vc2+(-1).*(q1.*Rc1+q2.*Rc2).*Vc3).*((Rc2.*Vc1+(-1).*Rc1.*Vc2) ...
  .^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.*Vc3).^2).^( ...
  -1/2),2.*((-1).*q1.*Rc2.*Vc1+q0.*Rc3.*Vc1+q1.*Rc1.*Vc2+q3.*Rc3.* ...
  Vc2+(-1).*(q0.*Rc1+q3.*Rc2).*Vc3).*((Rc2.*Vc1+(-1).*Rc1.*Vc2).^2+( ...
  Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.*Vc3).^2).^(-1/2); ...
  2.*((-1).*q1.*Rc2.*Vc1+q0.*Rc3.*Vc1+q1.*Rc1.*Vc2+q3.*Rc3.*Vc2+(-1) ...
  .*(q0.*Rc1+q3.*Rc2).*Vc3).*((Rc2.*Vc1+(-1).*Rc1.*Vc2).^2+(Rc3.* ...
  Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.*Vc3).^2).^(-1/2),2.*(( ...
  -1).*q0.*Rc2.*Vc1+(-1).*q1.*Rc3.*Vc1+q0.*Rc1.*Vc2+(-1).*q2.*Rc3.* ...
  Vc2+q1.*Rc1.*Vc3+q2.*Rc2.*Vc3).*((Rc2.*Vc1+(-1).*Rc1.*Vc2).^2+( ...
  Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.*Vc3).^2).^(-1/2), ...
  2.*((-1).*q3.*Rc2.*Vc1+q2.*Rc3.*Vc1+q3.*Rc1.*Vc2+(-1).*q1.*Rc3.* ...
  Vc2+(-1).*q2.*Rc1.*Vc3+q1.*Rc2.*Vc3).*((Rc2.*Vc1+(-1).*Rc1.*Vc2) ...
  .^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.*Vc3).^2).^( ...
  -1/2),2.*((-1).*q2.*Rc2.*Vc1+(-1).*q3.*Rc3.*Vc1+q2.*Rc1.*Vc2+q0.* ...
  Rc3.*Vc2+q3.*Rc1.*Vc3+(-1).*q0.*Rc2.*Vc3).*((Rc2.*Vc1+(-1).*Rc1.* ...
  Vc2).^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.*Vc3).^2) ...
  .^(-1/2);2.*((-1).*q0.*Rc2.*Vc1+(-1).*q1.*Rc3.*Vc1+q0.*Rc1.*Vc2+( ...
  -1).*q2.*Rc3.*Vc2+q1.*Rc1.*Vc3+q2.*Rc2.*Vc3).*((Rc2.*Vc1+(-1).* ...
  Rc1.*Vc2).^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1).*Rc2.* ...
  Vc3).^2).^(-1/2),2.*(q1.*Rc2.*Vc1+(-1).*q0.*Rc3.*Vc1+(-1).*q1.* ...
  Rc1.*Vc2+(-1).*q3.*Rc3.*Vc2+q0.*Rc1.*Vc3+q3.*Rc2.*Vc3).*((Rc2.* ...
  Vc1+(-1).*Rc1.*Vc2).^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.*Vc2+(-1) ...
  .*Rc2.*Vc3).^2).^(-1/2),2.*(q2.*Rc2.*Vc1+q3.*Rc3.*Vc1+(-1).*q2.* ...
  Rc1.*Vc2+(-1).*q0.*Rc3.*Vc2+(-1).*q3.*Rc1.*Vc3+q0.*Rc2.*Vc3).*(( ...
  Rc2.*Vc1+(-1).*Rc1.*Vc2).^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+(Rc3.* ...
  Vc2+(-1).*Rc2.*Vc3).^2).^(-1/2),2.*((-1).*q3.*Rc2.*Vc1+q2.*Rc3.* ...
  Vc1+q3.*Rc1.*Vc2+(-1).*q1.*Rc3.*Vc2+(-1).*q2.*Rc1.*Vc3+q1.*Rc2.* ...
  Vc3).*((Rc2.*Vc1+(-1).*Rc1.*Vc2).^2+(Rc3.*Vc1+(-1).*Rc1.*Vc3).^2+( ...
  Rc3.*Vc2+(-1).*Rc2.*Vc3).^2).^(-1/2)];

pCb3pXstate = [pCb3pQvec, zeros(3,9)];

% ---------------------------------------------------------------------------

pN3vec1pQvec = 2*[q2, q3, q0, q1];
pN3vec2pQvec = 2*[-q1, -q0, q3, q2];
pN3vec3pQvec = 2*[q0, -q1, -q2, q3];



dotTerm = (n3Vec'*rSunDeputy);
DrSunDeputyDrho = -eye(3)/norm(rSun - rDeputy) ...
               + (rSun - rDeputy)*(rSun - rDeputy)'/norm(rSun - rDeputy)^3;
DAccDrho = 2*PD*dotTerm/norm(rSun - rDeputy)^4*...
    (C1*rSunDeputy + (C2*dotTerm + C3)*n3Vec)*(rSun - rDeputy)'...
    + PD/norm(rSun - rDeputy)^2*( (C1*rSunDeputy + (C2*dotTerm + C3)*n3Vec)*n3Vec'...
    + dotTerm*(C1*eye(3) + C2*n3Vec*n3Vec') )*DrSunDeputyDrho;

Dn3VecDQvec = [pN3vec1pQvec;pN3vec2pQvec;pN3vec3pQvec];
DAccDQvec = PD/norm(rSun - rDeputy)^2*((C1*rSunDeputy + (C2*dotTerm + C3)*n3Vec)*rSunDeputy'...
    + dotTerm*((C2*dotTerm + C3)*eye(3) + C2*n3Vec*rSunDeputy'))*Dn3VecDQvec;

% ------------------------------------------------------------------------
DAccDXstate = [DAccDQvec, zeros(3), DAccDrho, zeros(3)];
PartialDelAccsrp_PartialXstate = CBmatrix*DAccDXstate + ...
    [Acc'*pCb1pXstate; Acc'*pCb2pXstate; Acc'*pCb3pXstate];


%% Partial of the relaive gravity froce on the deputy plate

pDelAccgprho = [(-1).*muEarth.*((Rc2+rho2).^2+(Rc3+rho3).^2).*((Rc1+ ...
  rho1).^2+(Rc2+rho2).^2+(Rc3+rho3).^2).^(-3/2),muEarth.*(Rc1+rho1) ...
  .*(Rc2+rho2).*((Rc1+rho1).^2+(Rc2+rho2).^2+(Rc3+rho3).^2).^(-3/2), ...
  muEarth.*(Rc1+rho1).*(Rc3+rho3).*((Rc1+rho1).^2+(Rc2+rho2).^2+( ...
  Rc3+rho3).^2).^(-3/2);muEarth.*(Rc1+rho1).*(Rc2+rho2).*((Rc1+rho1) ...
  .^2+(Rc2+rho2).^2+(Rc3+rho3).^2).^(-3/2),(-1).*muEarth.*((Rc1+ ...
  rho1).^2+(Rc3+rho3).^2).*((Rc1+rho1).^2+(Rc2+rho2).^2+(Rc3+rho3) ...
  .^2).^(-3/2),muEarth.*(Rc2+rho2).*(Rc3+rho3).*((Rc1+rho1).^2+(Rc2+ ...
  rho2).^2+(Rc3+rho3).^2).^(-3/2);muEarth.*(Rc1+rho1).*(Rc3+rho3).*( ...
  (Rc1+rho1).^2+(Rc2+rho2).^2+(Rc3+rho3).^2).^(-3/2),muEarth.*(Rc2+ ...
  rho2).*(Rc3+rho3).*((Rc1+rho1).^2+(Rc2+rho2).^2+(Rc3+rho3).^2).^( ...
  -3/2),(-1).*muEarth.*((Rc1+rho1).^2+(Rc2+rho2).^2).*((Rc1+rho1) ...
  .^2+(Rc2+rho2).^2+(Rc3+rho3).^2).^(-3/2)];
PartialDelGrav_PartialXstate = [zeros(3,7), pDelAccgprho, zeros(3)];


%% Partial of the coriolis effect on the deputy plate

pDelCoriolisprhorhodot = [omegaCh2.^2+omegaCh3.^2,(-1).*omegaCh1.*omegaCh2+omegaCh3,(-1).* ...
  omegaCh2+(-1).*omegaCh1.*omegaCh3,0,2.*omegaChdot3,(-2).* ...
  omegaChdot2;(-1).*omegaCh1.*omegaCh2+(-1).*omegaCh3,omegaCh1.^2+ ...
  omegaCh3.^2,omegaCh1+(-1).*omegaCh2.*omegaCh3,(-2).*omegaChdot3,0, ...
  2.*omegaChdot1;omegaCh2+(-1).*omegaCh1.*omegaCh3,(-1).*omegaCh1+( ...
  -1).*omegaCh2.*omegaCh3,omegaCh1.^2+omegaCh2.^2,2.*omegaChdot2,( ...
  -2).*omegaChdot1,0];
PartialDelCoriolis_PartialXstate = [zeros(3,7), pDelCoriolisprhorhodot];


%% Partial of the accelerations on the deputy plate

PartialRelAcceleration  = PartialDelGrav_PartialXstate + ...
    PartialDelAccsrp_PartialXstate + PartialDelCoriolis_PartialXstate;


%% Partial of the relative velocity of the deputy plate

PartialRelVelocity = [zeros(3,7), eye(3), zeros(3)];

%% Partial of angular velocity

PartialAngularVel=[0,0,0,0,i1.^(-1).*(i2+(-1).*i3).*omg3,i1.^(-1).*(i2+(-1).*i3).* ...
  omg2;0,0,0,i2.^(-1).*((-1).*i1+i3).*omg3,0,i2.^(-1).*((-1).*i1+i3) ...
  .*omg1;0,0,0,(i1+(-1).*i2).*i3.^(-1).*omg2,(i1+(-1).*i2).*i3.^(-1) ...
  .*omg1,0];
PartialAngularVel = [PartialAngularVel, zeros(3,7)];

%% Partial of MRPs

PartialQdot=[0,(-1/2).*omg1,(-1/2).*omg2,(-1/2).*omg3,(-1/2).*q1,(-1/2).*q2,( ...
  -1/2).*q3;(1/2).*omg1,0,(1/2).*omg3,(-1/2).*omg2,(1/2).*q0,(-1/2) ...
  .*q3,(1/2).*q2;(1/2).*omg2,(-1/2).*omg3,0,(1/2).*omg1,(1/2).*q3,( ...
  1/2).*q0,(-1/2).*q1;(1/2).*omg3,(1/2).*omg2,(-1/2).*omg1,0,(-1/2) ...
  .*q2,(1/2).*q1,(1/2).*q0];


PartialQdot = [PartialQdot, zeros(4,6)];

%% Partial of Fd with respect to the state vector

PartialFd = [PartialQdot; PartialAngularVel; PartialRelVelocity; PartialRelAcceleration];














